{
  "title": "Motionit Backend Performance Dashboard (v2)",
  "uid": "motionit-perf-v2",
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "refresh": "5s",
  "panels": [
    {
      "type": "timeseries",
      "title": "CPU Usage (%)",
      "targets": [
        {
          "expr": "system_cpu_usage * 100",
          "legendFormat": "CPU",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 0
      }
    },
    {
      "type": "timeseries",
      "title": "Heap Memory Used (MB)",
      "targets": [
        {
          "expr": "jvm_memory_used_bytes{area=\"heap\"} / 1024 / 1024",
          "legendFormat": "Heap",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 0
      }
    },
    {
      "type": "timeseries",
      "title": "GC Pause Duration (ms)",
      "targets": [
        {
          "expr": "rate(jvm_gc_pause_seconds_sum[1m]) * 1000",
          "legendFormat": "GC pause",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 0
      }
    },
    {
      "type": "timeseries",
      "title": "HTTP Request Rate (RPS)",
      "targets": [
        {
          "expr": "rate(http_server_requests_seconds_count[1m])",
          "legendFormat": "RPS",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 8
      }
    },
    {
      "type": "timeseries",
      "title": "Avg Response Time per URI (ms)",
      "targets": [
        {
          "expr": "(rate(http_server_requests_seconds_sum[1m]) / rate(http_server_requests_seconds_count[1m])) * 1000",
          "legendFormat": "avg latency",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 8
      }
    },
    {
      "type": "timeseries",
      "title": "HTTP 5xx Error Rate",
      "targets": [
        {
          "expr": "sum(rate(http_server_requests_seconds_count{status=~\"5..\"}[1m]))",
          "legendFormat": "5xx errors",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 8
      }
    },
    {
      "type": "timeseries",
      "title": "HikariCP Active Connections",
      "targets": [
        {
          "expr": "hikaricp_connections_active",
          "legendFormat": "active",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 16
      }
    },
    {
      "type": "timeseries",
      "title": "HikariCP Pending Threads",
      "targets": [
        {
          "expr": "hikaricp_connections_pending",
          "legendFormat": "pending",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 16
      }
    },
    {
      "type": "timeseries",
      "title": "JVM Thread Count",
      "targets": [
        {
          "expr": "jvm_threads_live_threads",
          "legendFormat": "threads",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 16
      }
    },
    {
      "type": "timeseries",
      "title": "Mission Completion Duration (s)",
      "targets": [
        {
          "expr": "rate(mission_complete_seconds_sum[1m]) / rate(mission_complete_seconds_count[1m])",
          "legendFormat": "mission avg time",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 24
      }
    },
    {
      "type": "timeseries",
      "title": "Mission Completion Count (5m)",
      "targets": [
        {
          "expr": "increase(mission_complete_seconds_count[5m])",
          "legendFormat": "completed",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 24
      }
    },
    {
      "type": "timeseries",
      "title": "AI Summary Failures (10m)",
      "targets": [
        {
          "expr": "increase(ai_summary_failures_total[10m])",
          "legendFormat": "AI fails",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 24
      }
    },
    {
      "type": "timeseries",
      "title": "YouTube API Latency (ms)",
      "targets": [
        {
          "expr": "rate(youtube_api_latency_seconds_sum[1m]) / rate(youtube_api_latency_seconds_count[1m]) * 1000",
          "legendFormat": "YouTube",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 32
      }
    },
    {
      "type": "timeseries",
      "title": "GPT AI API Latency (ms)",
      "targets": [
        {
          "expr": "rate(ai_summary_seconds_sum[1m]) / rate(ai_summary_seconds_count[1m]) * 1000",
          "legendFormat": "AI latency",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 32
      }
    },
    {
      "type": "timeseries",
      "title": "External API Failures (5m)",
      "targets": [
        {
          "expr": "increase(youtube_api_failures_total[5m]) + increase(ai_summary_failures_total[5m])",
          "legendFormat": "API fails",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 32
      }
    },
    {
      "type": "timeseries",
      "title": "K6 Virtual Users",
      "targets": [
        {
          "expr": "k6_vus",
          "legendFormat": "VU",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 40
      }
    },
    {
      "type": "timeseries",
      "title": "K6 Req Duration (ms)",
      "targets": [
        {
          "expr": "rate(k6_http_req_duration_sum[1m]) / rate(k6_http_req_duration_count[1m])",
          "legendFormat": "K6 latency",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 40
      }
    },
    {
      "type": "timeseries",
      "title": "K6 Failure Rate (%)",
      "targets": [
        {
          "expr": "rate(k6_http_req_failed[1m]) / rate(k6_http_reqs[1m]) * 100",
          "legendFormat": "failure %",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 40
      }
    }
  ]
}